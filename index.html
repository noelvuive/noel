<!DOCTYPE html>
<html>
<head>
    <title>3D NEON DOODLE - MAGIC üåü</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        canvas { display: block; }
        
        /* B·∫£ng v·∫Ω r∆°i t·ª´ tr√™n xu·ªëng */
        #drawingContainer {
            position: absolute; top: -600px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 400px; background: #222; border: 4px solid #ff00ff;
            border-radius: 15px; z-index: 1000; box-shadow: 0 0 30px #ff00ff;
            transition: top 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; align-items: center; padding: 10px;
        }
        
        #paintCanvas { background: #000; border-radius: 10px; touch-action: none; cursor: crosshair; }
        
        #controls { margin-top: 15px; display: flex; gap: 10px; }
        
        button {
            padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        
        #okBtn { background: #ff00ff; color: white; }
        #clearBtn { background: #444; color: white; }
        button:active { transform: scale(0.9); }

        #hint {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: #ff00ff; font-weight: bold; pointer-events: none; opacity: 0;
            transition: 1s;
        }
    </style>
</head>
<body>

    <div id="drawingContainer">
        <h3 style="color: #ff00ff; margin: 5px;">V·∫º G√å ƒê√ì ƒêI ‚ú®</h3>
        <canvas id="paintCanvas" width="280" height="300"></canvas>
        <div id="controls">
            <button id="clearBtn">XO√Å</button>
            <button id="okBtn">OK - BI·∫æN H√åNH!</button>
        </div>
    </div>

    <div id="hint">D√ôNG TAY XOAY H√åNH V·∫º 3D C·ª¶A B·∫†N! üí´</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // --- 1. SETUP THREE.JS ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(0, 0, 50);
        controls.enabled = false; // T·∫Øt xoay khi ƒëang v·∫Ω

        // --- 2. LOGIC B·∫¢NG V·∫º 2D ---
        const pCanvas = document.getElementById('paintCanvas');
        const ctx = pCanvas.getContext('2d');
        let drawing = false;
        let paths = []; // L∆∞u c√°c n√©t v·∫Ω

        // Hi·ªáu ·ª©ng r∆°i b·∫£ng v·∫Ω
        setTimeout(() => { document.getElementById('drawingContainer').style.top = '50px'; }, 500);

        function getPos(e) {
            const rect = pCanvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        pCanvas.addEventListener('pointerdown', (e) => {
            drawing = true;
            paths.push([]); // B·∫Øt ƒë·∫ßu n√©t m·ªõi
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        });

        pCanvas.addEventListener('pointermove', (e) => {
            if (!drawing) return;
            const pos = getPos(e);
            ctx.strokeStyle = '#ff00ff';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            paths[paths.length - 1].push({ x: (pos.x - 140) * 0.15, y: (150 - pos.y) * 0.15 });
        });

        window.addEventListener('pointerup', () => drawing = false);

        document.getElementById('clearBtn').onclick = () => {
            ctx.clearRect(0, 0, pCanvas.width, pCanvas.height);
            paths = [];
        };

        // --- 3. BI·∫æN H√åNH 2D TH√ÄNH 3D ---
        const doodleGroup = new THREE.Group();
        scene.add(doodleGroup);

        document.getElementById('okBtn').onclick = () => {
            if (paths.length === 0) return;

            // ·∫®n b·∫£ng v·∫Ω
            document.getElementById('drawingContainer').style.top = '-600px';
            document.getElementById('hint').style.opacity = '1';
            controls.enabled = true;

            // T·∫°o c√°c d·∫£i Neon 3D t·ª´ n√©t v·∫Ω
            paths.forEach(path => {
                if (path.length < 2) return;
                const points = path.map(p => new THREE.Vector3(p.x, p.y, 0));
                const curve = new THREE.CatmullRomCurve3(points);
                const geometry = new THREE.TubeGeometry(curve, path.length * 2, 0.4, 8, false);
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0xff00ff, emissive: 0xff00ff, emissiveIntensity: 5 
                });
                const mesh = new THREE.Mesh(geometry, material);
                doodleGroup.add(mesh);
            });

            // Th√™m √°nh s√°ng r·ª±c r·ª°
            const light = new THREE.PointLight(0xff00ff, 2, 100);
            scene.add(light);
        };

        // --- 4. TUY·∫æT R∆†I N·ªÄN ---
        const sGeo = new THREE.BufferGeometry();
        const sP = new Float32Array(2000 * 3);
        for(let i=0; i<6000; i++) sP[i] = (Math.random()-0.5)*100;
        sGeo.setAttribute('position', new THREE.BufferAttribute(sP, 3));
        const snow = new THREE.Points(sGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
        scene.add(snow);

        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            // Tuy·∫øt r∆°i
            const pos = sGeo.attributes.position.array;
            for(let i=1; i<pos.length; i+=3) {
                pos[i] -= 0.1;
                if(pos[i] < -50) pos[i] = 50;
            }
            sGeo.attributes.position.needsUpdate = true;

            // Xoay nh·∫π h√¨nh v·∫Ω 3D cho lung linh
            if (doodleGroup.children.length > 0) {
                doodleGroup.rotation.y += 0.005;
            }

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
